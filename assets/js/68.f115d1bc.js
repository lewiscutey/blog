(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{195:function(a,t,n){"use strict";n.r(t);var e=n(2),s=Object(e.a)({},function(){var a=this,t=a.$createElement,n=a._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[n("p",[a._v("è¿™ä¸ªéœ€æ±‚åšä¸‹æ¥å‚è€ƒäº†ä¸å°‘æ–‡ç« ï¼Œå…¶å®å¤§å¤šéƒ½æ˜¯ä¸€çŸ¥åŠè§£ï¼Œæ¯ä¸ªäººé‡åˆ°çš„é—®é¢˜ä¸åŒï¼Œè¿™ç¯‡æ–‡ç« å¯ä»¥è¯´å½»åº•è§£å†³"),n("code",[a._v("wx.chooseImage")]),a._v("çš„å„ç§ç–‘éš¾æ‚ç—‡ï¼Œä¸€æ­¥åˆ°ä½,å› æ­¤è¶ç€ä»Šå¤©ä¼‘æ¯æŠŠæ•´ä¸ªè¿‡ç¨‹è®°å½•ä¸‹æ¥ï¼Œåˆ†äº«ç»™ä¹‹åæœ‰éœ€è¦çš„å„ä½åŒè¡Œï¼\n")]),a._v(" "),n("blockquote",[n("p",[a._v("æœ€è¿‘åœ¨åšä¸€ä¸ªå¤æ‚çš„è·¨äº”ç«¯ï¼ˆPCã€H5ã€å°ç¨‹åºã€iOSã€androidï¼‰çš„éœ€æ±‚ï¼Œå†æ—¶å°†è¿‘ä¸¤ä¸ªå¤šæœˆï¼Œå…¶ä¸­é…¸ç”œè‹¦è¾£å†·æš–è‡ªçŸ¥ï¼Œè¿‘æ—¥ç»ˆäºå¯ä»¥å°æ¿ä¸Šçº¿ï¼Œå›å¿†æ•´ä¸ªå¼€å‘è¿‡ç¨‹ï¼Œæ·±å‘ä¸æ–­ï¼Œæ”¶è·é¢‡å¤šï¼Œä»Šå¤©å…ˆåˆ†äº«ä¸€ä¸‹åœ¨å¾®ä¿¡å°ç¨‹åºçš„web-viewé‡Œé€‰å–ç…§ç‰‡çš„åŠŸèƒ½ï¼Œæ­¤æ–‡å®Œæ•´çš„è®°å½•æ•´ä¸ªå¼€å‘è¿‡ç¨‹ï¼Œå½»åº•è§£å†³å„ç§ç–‘éš¾æ‚ç—‡ã€‚")])]),a._v(" "),n("h2",{attrs:{id:"æ·±åº¦è°ƒç ”"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#æ·±åº¦è°ƒç ”","aria-hidden":"true"}},[a._v("#")]),a._v(" æ·±åº¦è°ƒç ”")]),a._v(" "),n("p",[a._v("å› ä¸ºè·¨ç«¯æ‰€ä»¥æœ€å¼€å§‹ä½¿ç”¨äº†"),n("code",[a._v('<input type="file" accept="image/*" capture="camera">')]),a._v("çš„æ–¹å¼ï¼Œç®€å•ç²—æš´å¯ä½¿ç”¨ï¼Œäº”ç«¯å‹‰å¼ºéƒ½å¯ä»¥æ‰“ä¸ªåŠæ ¼åˆ†ï¼Œä¸€ç›´åˆ°è”è°ƒç»“æŸPMæ£€æµ‹æ—¶è¯´ä½“éªŒå¤ªå·®äº†ï¼Œè¶ç€è¿˜æœ‰æ—¶é—´ï¼ˆå…¶å®æˆ‘ä¹Ÿçœ‹ä¸ä¸‹å»ï¼‰ï¼Œç´¢æ€§å°±æŒ‰PMçš„è¦æ±‚æ¥ï¼Œå¼€å§‹è®¡åˆ’è°ƒç”¨åŸç”Ÿçš„ï¼Œå› ä¸ºå®¢æˆ·ç«¯ä¹‹å‰å·²ç»æä¾›äº†è¿™æ ·çš„"),n("strong",[a._v("bridge")]),a._v("ï¼Œæ‰€ä»¥å’Œå®¢æˆ·ç«¯çš„å¤´åƒè°ƒè¯•è½»æ¾å®Œæˆï¼Œå‰©ä¸‹çš„å°ç¨‹åºå†ç»ä¸‡åƒç£¨éš¾ï¼Œæœ€ç»ˆå®Œç¾è°¢å¹•ã€‚")]),a._v(" "),n("p",[a._v("é¦–å…ˆæ²¡æœ‰åšè¿‡è¿™æ–¹é¢çš„ç»éªŒï¼Œä¸¤çœ¼ä¸€æŠ¹é»‘ï¼Œç”±äºæ˜¯æŠŠH5é¡µé¢åµŒå¥—åœ¨å°ç¨‹åºçš„"),n("strong",[a._v("web-view")]),a._v("é‡Œï¼Œæ‰€ä»¥ç›´æ¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œå°ç¨‹åºå‘web-viewæä¾›äº†ä¸‰åå¤šä¸ªAPI-"),n("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/component/web-view.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("è¯¦æƒ…æ–‡æ¡£"),n("OutboundLink")],1),a._v("ã€‚è‡³æ­¤ä»¥ä¸ºå¯ä»¥è½»æ¾æå®šï¼Œäºæ˜¯å¼€å§‹äº†ä¸æ–­çš„è¶Ÿå‘ã€‚ã€‚ã€‚")]),a._v(" "),n("h2",{attrs:{id:"æŒ‰æ­¥å¼€å‘"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#æŒ‰æ­¥å¼€å‘","aria-hidden":"true"}},[a._v("#")]),a._v(" æŒ‰æ­¥å¼€å‘")]),a._v(" "),n("p",[a._v("åˆšå¼€å§‹ç›´æ¥åœ¨H5é‡Œä½¿ç”¨äº†"),n("code",[a._v("wx.chooseImage")]),a._v(",å‘ç°åœ¨å¼€å‘è€…å·¥å…·ä¸­ä¸æ–­çš„æŠ¥é”™"),n("code",[a._v("the permission value is offline verifying")]),a._v(",æ…¢æ…¢å¼€å§‹æœç´¢æ‰å‘ç°åœ¨å°ç¨‹åºçš„web-viewé‡Œä¹Ÿå¿…é¡»ä½¿ç”¨"),n("strong",[a._v("jweixin")]),a._v(",å…¶å®å°±æ˜¯ä¸ªå…¬ä¼—å·ç½‘é¡µï¼Œæ¥ä¸‹æ¥å¼€å§‹æŒ‰"),n("a",{attrs:{href:"https://qydev.weixin.qq.com/wiki/index.php?title=%E5%BE%AE%E4%BF%A1JS-SDK%E6%8E%A5%E5%8F%A3#.E6.AD.A5.E9.AA.A4.E4.B8.80.EF.BC.9A.E5.BC.95.E5.85.A5JS.E6.96.87.E4.BB.B6",target:"_blank",rel:"noopener noreferrer"}},[a._v("è¿™å¥—æµç¨‹"),n("OutboundLink")],1),a._v("èµ°:")]),a._v(" "),n("ol",[n("li",[a._v("å¼•å…¥JSæ–‡ä»¶")])]),a._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("// æ¨èä½¿ç”¨1.3.2ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œä¹‹å‰çš„ç‰ˆæœ¬å¾ˆå¤šå‘ğŸ˜­\nhttps://res.wx.qq.com/open/js/jweixin-1.3.2.js\n// æˆ‘æ˜¯ç›´æ¥ç”¨çš„npmåŒ…ï¼Œç›®å‰åŸºäº1.4.0-testçš„ç‰ˆæœ¬\nnpm install weixin-js-sdk\n")])])]),n("ol",{attrs:{start:"2"}},[n("li",[a._v("é€šè¿‡configæ¥å£æ³¨å…¥æƒé™éªŒè¯é…ç½®")])]),a._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[a._v("wx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("config")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    debug"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// å¼€å¯è°ƒè¯•æ¨¡å¼,è°ƒç”¨çš„æ‰€æœ‰apiçš„è¿”å›å€¼ä¼šåœ¨å®¢æˆ·ç«¯alertå‡ºæ¥ï¼Œè‹¥è¦æŸ¥çœ‹ä¼ å…¥çš„å‚æ•°ï¼Œå¯ä»¥åœ¨pcç«¯æ‰“å¼€ï¼Œå‚æ•°ä¿¡æ¯ä¼šé€šè¿‡logæ‰“å‡ºï¼Œä»…åœ¨pcç«¯æ—¶æ‰ä¼šæ‰“å°ã€‚")]),a._v("\n    appId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v("''")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// å¿…å¡«ï¼Œå¾®ä¿¡å…¬ä¼—å·çš„å”¯ä¸€æ ‡è¯†ï¼Œæ­¤å¤„å¡«å†™å…¬ä¼—å·çš„appId")]),a._v("\n    timestamp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// å¿…å¡«ï¼Œç”Ÿæˆç­¾åçš„æ—¶é—´æˆ³")]),a._v("\n    nonceStr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v("''")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// å¿…å¡«ï¼Œç”Ÿæˆç­¾åçš„éšæœºä¸²")]),a._v("\n    signature"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v("''")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// å¿…å¡«ï¼Œç­¾å")]),a._v("\n    jsApiList"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// å¿…å¡«ï¼Œéœ€è¦ä½¿ç”¨çš„JSæ¥å£åˆ—è¡¨ï¼Œæ‰€æœ‰JSæ¥å£åˆ—è¡¨è§é™„å½•2")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),n("ol",{attrs:{start:"3"}},[n("li",[a._v("é€šè¿‡readyæ¥å£å¤„ç†æˆåŠŸéªŒè¯")])]),a._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("wx.ready(function(){\n    // configä¿¡æ¯éªŒè¯åä¼šæ‰§è¡Œreadyæ–¹æ³•ï¼Œæ‰€æœ‰æ¥å£è°ƒç”¨éƒ½å¿…é¡»åœ¨configæ¥å£è·å¾—ç»“æœä¹‹åï¼Œconfigæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯çš„å¼‚æ­¥æ“ä½œï¼Œæ‰€ä»¥å¦‚æœéœ€è¦åœ¨é¡µé¢åŠ è½½æ—¶å°±è°ƒç”¨ç›¸å…³æ¥å£ï¼Œåˆ™é¡»æŠŠç›¸å…³æ¥å£æ”¾åœ¨readyå‡½æ•°ä¸­è°ƒç”¨æ¥ç¡®ä¿æ­£ç¡®æ‰§è¡Œã€‚å¯¹äºç”¨æˆ·è§¦å‘æ—¶æ‰è°ƒç”¨çš„æ¥å£ï¼Œåˆ™å¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œä¸éœ€è¦æ”¾åœ¨readyå‡½æ•°ä¸­ã€‚\n});\n")])])]),n("ol",{attrs:{start:"4"}},[n("li",[a._v("é€šè¿‡erroræ¥å£å¤„ç†å¤±è´¥éªŒè¯")])]),a._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("wx.error(function(res){\n    // configä¿¡æ¯éªŒè¯å¤±è´¥ä¼šæ‰§è¡Œerrorå‡½æ•°ï¼Œå¦‚ç­¾åè¿‡æœŸå¯¼è‡´éªŒè¯å¤±è´¥ï¼Œå…·ä½“é”™è¯¯ä¿¡æ¯å¯ä»¥æ‰“å¼€configçš„debugæ¨¡å¼æŸ¥çœ‹ï¼Œä¹Ÿå¯ä»¥åœ¨è¿”å›çš„reså‚æ•°ä¸­æŸ¥çœ‹ï¼Œå¯¹äºSPAå¯ä»¥åœ¨è¿™é‡Œæ›´æ–°ç­¾åã€‚\n});\n")])])]),n("ol",{attrs:{start:"5"}},[n("li",[a._v("åˆ¤æ–­å½“å‰å®¢æˆ·ç«¯ç‰ˆæœ¬æ˜¯å¦æ”¯æŒæŒ‡å®šJSæ¥å£")])]),a._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v('wx.checkJsApi({\n    jsApiList: [\'chooseImage\'] // éœ€è¦æ£€æµ‹çš„JSæ¥å£åˆ—è¡¨\n    success: function(res) {\n    // ä»¥é”®å€¼å¯¹çš„å½¢å¼è¿”å›ï¼Œå¯ç”¨çš„apiå€¼trueï¼Œä¸å¯ç”¨ä¸ºfalse\n    // å¦‚ï¼š{"checkResult":{"chooseImage":true},"errMsg":"checkJsApi:ok"}\n    },\n    fail: function(err) {\n    // checkJsApiæ¥å£è°ƒç”¨å¤±è´¥\n    }\n});\n')])])]),n("ol",{attrs:{start:"6"}},[n("li",[a._v("æ¥å£è°ƒç”¨")])]),a._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("wx.chooseImage({\n    count: 1, // é»˜è®¤9\n    sizeType: ['original', 'compressed'], // å¯ä»¥æŒ‡å®šæ˜¯åŸå›¾è¿˜æ˜¯å‹ç¼©å›¾ï¼Œé»˜è®¤äºŒè€…éƒ½æœ‰\n    sourceType: ['album', 'camera'], // å¯ä»¥æŒ‡å®šæ¥æºæ˜¯ç›¸å†Œè¿˜æ˜¯ç›¸æœºï¼Œé»˜è®¤äºŒè€…éƒ½æœ‰\n    success: function (res) {\n        var localIds = res.localIds; // è¿”å›é€‰å®šç…§ç‰‡çš„æœ¬åœ°IDåˆ—è¡¨ï¼ŒlocalIdå¯ä»¥ä½œä¸ºimgæ ‡ç­¾çš„srcå±æ€§æ˜¾ç¤ºå›¾ç‰‡\n    }\n});\n")])])]),n("p",[n("strong",[a._v("æœ¬éƒ¨åˆ†è¦ç‰¹åˆ«æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š")])]),a._v(" "),n("ul",[n("li",[a._v("invalid url domainï¼šå½“å‰é¡µé¢æ‰€åœ¨åŸŸåä¸ä½¿ç”¨"),n("strong",[a._v("appid")]),a._v("æ²¡æœ‰ç»‘å®šï¼ˆå¯åœ¨è¯¥å…¬ä¼—å·åå°çš„åº”ç”¨å¯ä¿¡åŸŸåä¸­é…ç½®å½“å‰H5é¡µé¢çš„åŸŸåï¼‰ï¼›")]),a._v(" "),n("li",[a._v("invalid signatureç­¾åé”™è¯¯ï¼šå»ºè®®æŒ‰"),n("a",{attrs:{href:"https://qydev.weixin.qq.com/wiki/index.php?title=%E5%BE%AE%E4%BF%A1JS-SDK%E6%8E%A5%E5%8F%A3#.E9.99.84.E5.BD.956-.E5.B8.B8.E8.A7.81.E9.94.99.E8.AF.AF.E5.8F.8A.E8.A7.A3.E5.86.B3.E6.96.B9.E6.B3.95",target:"_blank",rel:"noopener noreferrer"}},[a._v("å¦‚ä¸‹é¡ºåºæ£€æŸ¥"),n("OutboundLink")],1),a._v("ï¼Œä¸»è¦å¯èƒ½æ˜¯åŸŸåä¸€èˆ¬å¸¦çš„å‚æ•°ï¼Œæ‰€ä»¥åŸŸåæ¯æ¬¡éƒ½ä¸ä¸€æ ·ï¼Œå¿…é¡»åœ¨è°ƒç”¨å‰é€šè¿‡åŸŸåæ¥è·å–signatureï¼›")]),a._v(" "),n("li",[a._v("æœåŠ¡ä¸Šçº¿ä¹‹åæ— æ³•è·å–jsapi_ticket,ä¸€èˆ¬æ˜¯access_tokenè°ƒç”¨æ¬¡æ•°è¿‡å¤šè¢«é™åˆ¶äº†ï¼Œéœ€è¦åœ¨æœåŠ¡ç«¯åšç¼“å­˜ï¼›")]),a._v(" "),n("li",[a._v("permission deniedï¼šè¯¥å…¬ä¼—å·å·æ²¡æœ‰æƒé™ä½¿ç”¨è¿™ä¸ªJSAPIï¼ˆéƒ¨åˆ†æ¥å£éœ€è¦è®¤è¯ä¹‹åæ‰èƒ½ä½¿ç”¨ï¼‰ï¼›")])]),a._v(" "),n("h2",{attrs:{id:"å¤„ç†å›¾ç‰‡æ•°æ®ä¸ºbase64"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#å¤„ç†å›¾ç‰‡æ•°æ®ä¸ºbase64","aria-hidden":"true"}},[a._v("#")]),a._v(" å¤„ç†å›¾ç‰‡æ•°æ®ä¸ºbase64")]),a._v(" "),n("p",[n("code",[a._v("wx.chooseImage")]),a._v("è·å–åˆ°çš„å›¾ç‰‡ä¸ºä¸€ä¸ªä¸´æ—¶è·¯å¾„ï¼Œå¾®ä¿¡åŒæ—¶æä¾›äº†"),n("code",[a._v("wx.getLocalImgData")]),a._v("æ–¹æ³•å¯ä»¥æŠŠè·å–åˆ°çš„è·¯å¾„è½¬ä¸ºbase64æ ¼å¼çš„æ•°æ®ï¼Œè‡³æ­¤å°±å¯ä»¥è½»æ¾è®¸å¤šäº†ï¼Œä½†æ˜¯è½¬å‡ºæ¥çš„base64åœ¨androidå’ŒiOSä¸­ç¨æœ‰ä¸åŒï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„ä¸€ä¸‹ï¼š")]),a._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("wx.getLocalImgData({\n    localId: req.localIds[0].toString(),\n    success: function (res) {\n        const localData = res.localData;\n        let imageBase64 = '';\n        if (localData.indexOf('data:image') == 0) {\n            //è‹¹æœçš„ç›´æ¥èµ‹å€¼ï¼Œé»˜è®¤ç”Ÿæˆ'data:image/jpeg;base64,'çš„å¤´éƒ¨æ‹¼æ¥\n            imageBase64 = localData;\n        } else {\n            //æ­¤å¤„æ˜¯å®‰å“ä¸­çš„å”¯ä¸€å¾—å‘ï¼åœ¨æ‹¼æ¥å‰éœ€è¦å¯¹localDataè¿›è¡Œæ¢è¡Œç¬¦çš„å…¨å±€æ›¿æ¢\n            //æ­¤æ—¶ä¸€ä¸ªæ­£å¸¸çš„base64å›¾ç‰‡è·¯å¾„å°±å®Œç¾ç”Ÿæˆèµ‹å€¼åˆ°imgçš„srcä¸­äº†\n            imageBase64 = 'data:image/jpeg;base64,' + localData.replace(/\\n/g, '');\n        }\n    }\n});\n")])])]),n("h2",{attrs:{id:"ä¸Šä¼ å›¾ç‰‡"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ä¸Šä¼ å›¾ç‰‡","aria-hidden":"true"}},[a._v("#")]),a._v(" ä¸Šä¼ å›¾ç‰‡")]),a._v(" "),n("blockquote",[n("p",[a._v("è·å–åˆ°å›¾ç‰‡çš„base64æ•°æ®ä¹‹åå…¶å®æˆ‘ä»¬å°±å¯ä»¥ä¸ºæ‰€æ¬²ä¸ºäº†ï¼Œä¸éœ€è¦ä½¿ç”¨"),n("code",[a._v("wx.uploadImage")]),a._v("å’Œ"),n("code",[a._v("wx.downloadImage")]),a._v("äº†ï¼Œä¸ä»…éœ€è¦éº»çƒ¦çš„ä¸Šä¼ åˆ°å¾®ä¿¡æœåŠ¡å™¨ï¼Œè¿˜æœ‰ä¸‰å¤©çš„æ—¶é—´é™åˆ¶åè€Œå¢åŠ äº†æˆæœ¬ï¼Œæœ€å¥½çš„æ–¹å¼å°±æ˜¯ç›´æ¥ä¸Šä¼ è‡³æˆ‘ä»¬è‡ªå·±çš„æœåŠ¡å™¨ã€‚")])]),a._v(" "),n("p",[a._v("ä¸€èˆ¬ä¸æœåŠ¡ç«¯äº¤äº’çš„è¿™ç§æ–‡ä»¶ç±»å‹ä¸€èˆ¬é‡‡ç”¨"),n("strong",[a._v("è¡¨å•æäº¤--multipart/form-data")]),a._v("çš„æ–¹å¼ï¼Œè¿™å°±è¦æ±‚æˆ‘ä»¬ç†Ÿæ‚‰ä¼ è¾“"),n("a",{attrs:{href:"https://www.cnblogs.com/shanyou/archive/2013/06/07/3123155.html",target:"_blank",rel:"noopener noreferrer"}},[n("strong",[a._v("form-data")]),n("OutboundLink")],1),a._v("çš„æ•°æ®äº¤äº’ï¼Œæ‰€ä»¥éœ€è¦æŠŠåˆšæ‰è·å–åˆ°çš„base64è½¬ä¸ºå¯postçš„äºŒè¿›åˆ¶æ•°æ®ï¼ŒJavaScriptæä¾›äº†åŸç”Ÿçš„"),n("code",[a._v("atob/btoa")]),a._v("ç”¨æ¥å¯¹base64è¿›è¡Œç¼–ç å’Œè§£ç ï¼›")]),a._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("base64ToBlob(dataurl) {\n    let arr = dataurl.split(',');\n    let mime = arr[0].match(/:(.*?);/)[1];\n    let bstr = atob(arr[1]);\n    let n = bstr.length;\n    let u8arr = new Uint8Array(n);\n    while (n--) {\n        u8arr[n] = bstr.charCodeAt(n);\n    }\n    return new Blob([u8arr], { type: mime });\n}\n")])])]),n("p",[a._v("ok,å¤„ç†å¥½å¯äº¤äº’çš„æ•°æ®å°±å¯ä»¥ä¸Šä¼ åˆ°è‡ªå·±çš„æœåŠ¡å™¨äº†ï¼Œä¹‹åç›¸å½“äºæ™®é€šH5é¡µé¢çš„å›¾ç‰‡äº¤äº’äº†,å¯ä¸Šä¼ å¯ä¸‹è½½ğŸ˜„")]),a._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("let param = new FormData();\nparam.append('headPic', imageData);\nthis.$http.post('/upload.json', {\n    headers: {\n        'Content-Type': 'multipart/form-data',\n    },\n    params: param,\n}).then(res => {\n    console.log('ä¸Šä¼ æˆåŠŸ', res);\n});\n")])])]),n("h2",{attrs:{id:"å®Œæ•´ä»£ç "}},[n("a",{staticClass:"header-anchor",attrs:{href:"#å®Œæ•´ä»£ç ","aria-hidden":"true"}},[a._v("#")]),a._v(" å®Œæ•´ä»£ç ")]),a._v(" "),n("p",[a._v("ç»ˆäºã€‚ã€‚ã€‚å¯ä»¥å‘Šä¸€æ®µè½äº†ï¼Œè‡³æ­¤å°ç¨‹åºçš„"),n("code",[a._v("web-view")]),a._v("é‡ŒæˆåŠŸä½¿ç”¨äº†"),n("code",[a._v("wx.chooseImage")]),a._v(",ä¸‹é¢æŠŠå®Œæ•´ä»£ç è´´å‡ºæ¥ï¼Œæ•¬è¯·å‚è€ƒğŸ˜„")]),a._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("<template>\n    <div class=\"card-avatar\">\n      <img\n        :src=\"avatarUrl\"\n      >\n      <div\n        class=\"choose-image\"\n        @click=\"chooseImage\"\n      />\n    </div>\n</template>\n\n<script>\nimport wx from 'weixin-js-sdk';\nconst imgUrl = require('../../common/assets/images/default-avatar.png')ï¼›\n\nexport default {\n  name: 'Card',\n  components: {\n  },\n  props: {\n  },\n  data() {\n    return {\n      avatarUrl: imgUrl,\n    };\n  },\n  computed: {\n  },\n  watch: {\n  },\n  mounted() {\n    this.getWxConfigDatas();\n  },\n  methods: {\n    getWxConfigDatas() {\n      const params = {\n        checkCode: getUrlParams().checkCode,  // ä»åœ°å€æ è·å–checkCodeç”¨äºæ ¡éªŒsignature\n      };\n      this.$http.get('/signature.json', { params }).then(res => {\n        if (res.content.data && res.content.data.signature) {\n          this.registereWxApi(res.content.data.signature);\n        }\n      });\n    },\n    registereWxApi(data) {\n      wx.config({\n        // debug: true,\n        jsApiList: ['chooseImage', 'getLocalImgData'],\n        appId: data.appId,\n        timestamp: data.timestamp,\n        nonceStr: data.nonceStr,\n        signature: data.signature,\n      });\n    },\n    chooseImage() {\n      let that = this;\n      if (window.__wxjs_environment === 'miniprogram') {\n        wx.miniProgram.getEnv(function(res) {\n          if (res.miniprogram) {\n            wx.checkJsApi({\n              jsApiList: ['chooseImage', 'getLocalImgData'],\n              success: function(res) {\n                if (res.checkResult.chooseImage) {\n                  wx.chooseImage({\n                    count: 1,\n                    sizeType: ['compressed'],\n                    sourceType: ['album', 'camera'],\n                    success: function(req) {\n                      wx.getLocalImgData({\n                        localId: req.localIds[0].toString(),\n                        success: function (res) {\n                          const localData = res.localData;\n                          let imageBase64 = '';\n                          if (localData.indexOf('data:image') == 0) {\n                            //è‹¹æœçš„ç›´æ¥èµ‹å€¼ï¼Œé»˜è®¤ç”Ÿæˆ'data:image/jpeg;base64,'çš„å¤´éƒ¨æ‹¼æ¥\n                            imageBase64 = localData;\n                          } else {\n                            //æ­¤å¤„æ˜¯å®‰å“ä¸­çš„å”¯ä¸€å¾—å‘ï¼åœ¨æ‹¼æ¥å‰éœ€è¦å¯¹localDataè¿›è¡Œæ¢è¡Œç¬¦çš„å…¨å±€æ›¿æ¢\n                            //æ­¤æ—¶ä¸€ä¸ªæ­£å¸¸çš„base64å›¾ç‰‡è·¯å¾„å°±å®Œç¾ç”Ÿæˆèµ‹å€¼åˆ°imgçš„srcä¸­äº†\n                            imageBase64 = 'data:image/jpeg;base64,' + localData.replace(/\\n/g, '');\n                          }\n                          that.avatarUrl = imageBase64;\n                          that.handleAvatar(that.dataURLtoBlob(imageBase64));\n                        }\n                      });\n                    },\n                    fail() {\n                      that.$toast.show({\n                        type: 'text',\n                        text: 'é€‰æ‹©å¤´åƒå¤±è´¥ï¼',\n                      });\n                    }\n                  });\n                } else {\n                  that.$toast.show({\n                    type: 'text',\n                    text: 'æš‚ä¸æ”¯æŒä¿®æ”¹å¤´åƒï¼',\n                  });\n                }\n              },\n              fail: function() {\n                that.$toast.show({\n                  type: 'text',\n                  text: 'æš‚ä¸æ”¯æŒä¿®æ”¹å¤´åƒï¼',\n                });\n              },\n            });\n          } else {\n            that.lgBridgeChooseImage();\n          }\n        });\n      } else {\n        that.lgBridgeChooseImage();\n      }\n    },\n    handleAvatar(imageData) {\n        let that = this;\n        let param = new FormData();\n        param.append('headPic', imageData);\n        that.$http.post('/upload.json', {\n            headers: {\n                'Content-Type': 'multipart/form-data',\n            },\n        params: param,\n        }).then(res => {\n        if (parseInt(res.state, 10) === 1) {\n            that.$toast.show({\n                type: 'success',\n                text: 'ä¸Šä¼ æˆåŠŸï¼',\n            });\n          that.avatarUrl = res.content && res.content.data && res.content.data.url;\n        }\n      });\n    },\n    dataURLtoBlob(dataurl) {\n      let arr = dataurl.split(',');\n      let mime = arr[0].match(/:(.*?);/)[1];\n      let bstr = atob(arr[1]);\n      let n = bstr.length;\n      let u8arr = new Uint8Array(n);\n      while (n--) {\n        u8arr[n] = bstr.charCodeAt(n);\n      }\n      return new Blob([u8arr], { type: mime });\n    }\n  }\n};\n<\/script>\n\n<style lang=\"less\" scoped>\n.card-avatar {\n    position: absolute;\n    top: 0;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    width: 180px;\n    height: 180px;\n    border-radius: 100%;\n    overflow: hidden;\n    img {\n      width: 100%;\n      height: 100%;\n    }\n    .choose-image, input {\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      opacity: 0;\n    }\n}\n</style>\n")])])]),n("p",[a._v("è¿™ä¸ªéœ€æ±‚åšä¸‹æ¥å‚è€ƒäº†ä¸å°‘æ–‡ç« ï¼Œå…¶å®å¤§å¤šéƒ½æ˜¯ä¸€çŸ¥åŠè§£ï¼Œæ¯ä¸ªäººé‡åˆ°çš„é—®é¢˜ä¸åŒï¼Œè¿™ç¯‡æ–‡ç« å¯ä»¥è¯´å½»åº•è§£å†³"),n("code",[a._v("wx.chooseImage")]),a._v("çš„å„ç§ç–‘éš¾æ‚ç—‡ï¼Œä¸€æ­¥åˆ°ä½,å› æ­¤è¶ç€ä»Šå¤©ä¼‘æ¯æŠŠæ•´ä¸ªè¿‡ç¨‹è®°å½•ä¸‹æ¥ï¼Œåˆ†äº«ç»™ä¹‹åæœ‰éœ€è¦çš„å„ä½åŒè¡Œï¼")])])},[],!1,null,null,null);t.default=s.exports}}]);